# Автор: Федорчук Дмитрий Сергеевич DEVOPS-33

# Домашнее задание к занятию 1.  «Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения»

## Задача 1

Опишите кратко, в чём основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.

## Решение 1.

**Полная (аппаратная) виртуализация** - это тип виртуализации, при котором происходит имитация работы физического оборудования сервера в виртуальной машине. Главный слой такой конфигурации - гипервизор. Гипервизор загружается на физическом сервере и обеспечивает взаимодействие между "железом" сервера и виртуальными машинами. Гипервизор имеет нулевой приоритет доступа к оборудованию сервера, виртуальные машины взаимодействуют с оборудованием напрямую. Сами виртуальные машины запускают свою копию операционной системы на виртуализированном оборудовании. Такой тип виртуализации позволяет запустить виртуальные машины с любыми операционными системами, которые поддерживаются оборудованием физического сервера. Также гостевые операционные системы виртуальных машин полностью изолированны друг от друга.

Пример аппаратной виртуализации: VMware ESXi.

**Паравиртуализация, она же виртуализация на базе программного гипервизора** - это тип виртуализации, при котором каждая отдельная гостевая виртуальная машина запускается внутри отдельного реализованного программно гипервизора. Программная реализация гипервизора, работающего внутри хостовой операционной системы, приводит к существенным дополнительным накладным расходам на эмуляцию работы с аппаратным обеспечением для гостевой операционной системы по сравнению с виртуализацией на базе аппаратного гипервизора. Операционная система взаимодействует с программой гипервизора, который предоставляет ей гостевой API, вместо использования напрямую таких ресурсов, как процессор, память. При таком типе виртуализации гостевая ОС знает о наличии гипервизора, т.к. выполнение инструкций происходит через него, происходит модификация ядра гостевой операционной системы. Паравиртуализация больше подходит для операционных систем с открытым исходным кодом.

Пример паравиртуализации: Oracle VM VirtualBox.

**Виртуализация на уровне операционной системы** - это тип виртуализации, при котором нет отдельного слоя гипервизора. Сама хостовая операционная система, установленная на физическом оборудовании, запускает изолированные виртуальные серверы, именуемые контейнерами. Также хостовая операционная система отвечает за разделение аппаратных ресурсов между несколькими виртуальными серверами и поддержку их изолированности друг от друга. Основным минусом виртуализации на уровне операционной системы является то, что эта технология не позволяет запускать ОС с ядрами, отличными от ядра хостовой ОС.

Пример виртуализация на уровне операционной системы: Docker.

## Задача 2

Выберите один из вариантов использования организации физических серверов в зависимости от условий использования.

Организация серверов:

- физические сервера,
- паравиртуализация,
- виртуализация уровня ОС.

Условия использования:

- высоконагруженная база данных, чувствительная к отказу;
- различные web-приложения;
- Windows-системы для использования бухгалтерским отделом;
- системы, выполняющие высокопроизводительные расчёты на GPU.

Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

## Решение 2.
* высоконагруженная база данных, чувствительная к отказу:

В данном случае я бы использовал физические серверы с быстрой дисковой подсистемой, т.к. база данных чувствительна к количеству операция ввода-вывода в секунду (IOPS). Саму базу данных создавал бы в виде кластера, например под управлением Patroni в случае использования PostgreSQL. 

Либо паравиртуальный кластер ESXi под управлением VMware vCenter. vCenter позволил бы настроить кластеризацию физических серверов так, что имея общий Datasore виртуальных машин, размещенный на СХД, при падении одного из серверов, его виртуальные машины перемещались бы на другой сервер кластера, без отказа виртуальных машин и почти без падения производительности.

Выбор решения будет зависеть от бюджета организации.

* различные web-приложения:

В данном случае я бы использовал виртуализацию уровня ОС. Все современные Web приложения существуют и для операционных систем, основанных на ядре Linux. Виртуализация уровня ОС позволила бы гибко управлять ресурсами контейнеров, легко настраивать сетевой стек и взаимодействие между разными контейнерами. В случае если потребовалось бы запустить Web приложение, которого не существует для операционных систем на ядре Linux, то тогда пришлось бы прибегнуть к паравиртуализации.

* Windows-системы для использования бухгалтерским отделом:

В данном случае нужно предметно рассматривать, что это за бухгалтерские приложения и с каким базами данных они работают. Но обычно это не сильно нагруженные приложения и базы данных. Лучше всего по моему мнению подойдет паравиртуализация. Можно будет гибко управлять выделяемыми бухгалтерским виртуальным машина ресурсами, выполнять их резервное копирование и при возможности настроить кластеризацию. Сами виртуальные машины можно запускать как для приложений на ОС Windows, так и Linux подобные операционные системы.  

* системы, выполняющие высокопроизводительные расчёты на GPU:

В данном случае считаю необходимым использовать только физический сервер, т.к. видеокарты с GPU будут лучше взаимодействовать напрямую с операционной системой. Виртуализация может снизить эффективность использования вычислительных ресурсов.  

## Задача 3

Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based-инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
2. Требуется наиболее производительное бесплатное open source-решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows-инфраструктуры.
4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

## Решение 3.

1. В этом сценарии подойдет как решение VMware ESXi, так и Hyper-V. Обе системы виртуализации поддерживают описанные требования. Но поскольку используется преимущественно Windows based-инфраструктура, то приоритетным бы я выбрал Hyper-V. К тому же в Hyper-V можно выполнять резервное копирование виртуальных машин встроенным в Windows инструментом - Windows Server Backup. А для резервного копирования виртуальных машин из ESXi потребуется использовать стороннее ПО, например, Veeam Backup & Replication.

2. В этом сценарии подойдет любое решение на базе KVM. Например, Proxmox Virtual Environment. Это решение основано на ядре операционной системы Debian, постоянно разрабатывается и улучшается, есть довольно обширное комьюнити.

3. В этом сценарии наиболее подойдет Xen PV, т.к. однотипные виртуальные машины Windows можно разворачивать основываясь на шаблонах. К тому же это бесплатный и достаточно зрелый продукт. Если удобство разворачивания виртуальных машин из шаблонов не важно, то можно использовать KVM.

4. В этом сценарии наиболее подойдет виртуализация на уровне ОС, например, Docker. На операционной системе c ядром Linux можно запускать разные контейнеры с другими версиями Linux, например, Alpine c openjdk11 для запуска и тестирования Java приложений.

## Задача 4

Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.
